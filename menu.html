<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ¡ãƒ‹ãƒ¥ãƒ¼ | è¦‹ç©Web</title>
    <link rel="stylesheet" href="menu_style.css">
</head>

<body>
    <header class="main-header">
        <div class="logo">ARK CRETON Inc.</div>
        <div class="header-right">
            <span id="userNameDisplay" class="user-info"></span>
            <button id="logoutBtn" onclick="handleLogout()">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
        </div>
    </header>

    <main class="menu-container">
        <h1>è¦‹ç©ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>

        <div class="menu-grid">
            <a href="index.html" class="menu-card primary">
                <div class="icon">â•</div>
                <h2>æ–°è¦ä½œæˆ</h2>
                <p>æ–°ã—ã„è¦‹ç©æ›¸ã‚’ä½œæˆã—ã¾ã™</p>
            </a>

            <a href="#" class="menu-card success" onclick="alert('ä¸€è¦§ç”»é¢ã¯æº–å‚™ä¸­ã§ã™')">
                <div class="icon">ğŸ“‹</div>
                <h2>ä½œæˆæ¸ˆä¸€è¦§</h2>
                <p>ç™ºè¡Œæ¸ˆã¿ã®è¦‹ç©ã‚’ç¢ºèªãƒ»ç·¨é›†ã—ã¾ã™</p>
            </a>

            <a href="#" class="menu-card draft" onclick="alert('ä¸‹æ›¸ãæ©Ÿèƒ½ã¯æº–å‚™ä¸­ã§ã™')">
                <div class="icon">ğŸ“</div>
                <h2>ä¸‹æ›¸ã</h2>
                <p>ä¿å­˜ä¸­ã®æœªå®Œæˆãƒ‡ãƒ¼ã‚¿ã‚’å†é–‹ã—ã¾ã™</p>
            </a>
        </div>
    </main>

    <footer class="footer">
        &copy; 2026 ARK CRETON Inc.
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="supabase.js"></script>

    <script>

        async function checkAuth() {
            try {
                const { data: { user }, error: authError } = await supabaseClient.auth.getUser();

                if (authError || !user) {
                    window.location.href = "login.html";
                    return;
                }

                const { data: userData, error: dbError } = await supabaseClient
                    .from('user_master')
                    .select('user_name')
                    .eq('login_email', user.email)
                    .single();

                const nameDisplay = document.getElementById('userNameDisplay');

                if (userData && userData.user_name) {
                    // 1. åå‰ã‚’ã‚»ãƒƒãƒˆã™ã‚‹
                    nameDisplay.innerText = userData.user_name + " ã•ã‚“";
                    // 2. ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³ã‚’é–‹å§‹ã•ã›ã‚‹ï¼
                    nameDisplay.classList.add('show');
                } else {
                    nameDisplay.innerText = user.email + " ã•ã‚“";
                    nameDisplay.classList.add('show');
                }

            } catch (err) {
                console.error("äºˆæœŸã›ã¬ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:", err);
            }
        }

        async function handleLogout() {
            if (confirm('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã™ã‹ï¼Ÿ')) {
                await supabaseClient.auth.signOut();
                window.location.href = "login.html";
            }
        }

        checkAuth();
    </script>
</body>

</html>